{"version":3,"file":"particle.js","sourceRoot":"","sources":["../../../src/node/ext/particle.ts"],"names":[],"mappings":"AAAA,OAAO,EAAe,MAAM,IAAI,UAAU,EAA0B,MAAM,SAAS,CAAA;AACnF,OAAO,EAAE,aAAa,EAAE,MAAM,6BAA6B,CAAA;AAC3D,OAAO,EAAE,UAAU,EAAqB,MAAM,qBAAqB,CAAA;AAgCnE,SAAS,MAAM,CAAC,GAAW,EAAE,GAAW;IACtC,OAAO,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,CAAA;AAC1C,CAAC;AAED,MAAM,OAAO,cAAe,SAAQ,UAAU;IAC5C,WAAW,CAAQ;IACnB,MAAM,CAAa;IACnB,SAAS,CAAa;IACtB,MAAM,CAAa;IACnB,SAAS,CAAa;IACtB,MAAM,CAAa;IACnB,WAAW,CAAS;IACpB,SAAS,CAAQ;IACjB,iBAAiB,CAAS;IAC1B,UAAU,CAAc;IAExB,QAAQ,CAAc;IACtB,mBAAmB,CAAe;IAClC,UAAU,GAAe,EAAE,CAAA;IAE3B,YAAY,OAA8B;QACxC,KAAK,CAAC,OAAO,CAAC,CAAA;QAEd,IAAI,CAAC,WAAW,GAAG,OAAO,CAAC,OAAO,CAAA;QAClC,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,KAAK,CAAA;QAC3B,IAAI,CAAC,SAAS,GAAG,OAAO,CAAC,QAAQ,CAAA;QACjC,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,KAAK,CAAA;QAC3B,IAAI,CAAC,SAAS,GAAG,OAAO,CAAC,QAAQ,CAAA;QACjC,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,KAAK,CAAA;QAC3B,IAAI,CAAC,WAAW,GAAG,OAAO,CAAC,UAAU,CAAA;QACrC,IAAI,CAAC,SAAS,GAAG,OAAO,CAAC,QAAQ,CAAA;QACjC,IAAI,CAAC,iBAAiB,GAAG,OAAO,CAAC,gBAAgB,CAAA;QACjD,IAAI,CAAC,UAAU,GAAG,OAAO,CAAC,SAAS,CAAA;QAEnC,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC,YAAY,EAAE,CAAA;IAChD,CAAC;IAED,KAAK,CAAC,YAAY;QAChB,IAAI,aAAa,CAAC,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC;YAChD,IAAI,CAAC,QAAQ,GAAG,aAAa,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,CAAA;QAC3D,CAAC;aAAM,CAAC;YACN,OAAO,CAAC,IAAI,CAAC,uCAAuC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAA;YACvE,IAAI,CAAC,QAAQ,GAAG,MAAM,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAA;QAC5D,CAAC;IACH,CAAC;IAED,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,CAAC,EAA4B;QAC5C,IAAI,CAAC,IAAI,CAAC,QAAQ;YAAE,MAAM,IAAI,CAAC,mBAAmB,CAAA;QAElD,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;QACtD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,EAAE,CAAC,EAAE,EAAE,CAAC;YAC/B,MAAM,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAA;YAC/D,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;YACtD,MAAM,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;YAC3B,MAAM,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;YAC3B,MAAM,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAA;YAC/D,MAAM,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;YAEtD,MAAM,MAAM,GAAG,IAAI,UAAU,CAAC;gBAC5B,CAAC,EAAE,CAAC;gBACJ,OAAO,EAAE,IAAI,CAAC,QAAQ;gBACtB,MAAM,EAAE,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,GAAG,EAAE;gBAC1B,KAAK,EAAE,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,KAAK,EAAE;gBAC7B,KAAK,EAAE,IAAI,CAAC,WAAW;gBACvB,SAAS,EAAE,IAAI,CAAC,UAAU;gBAC1B,QAAQ,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,SAAS;aACrD,CAAC,CAAA;YAEF,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC;gBACnB,MAAM;gBACN,GAAG,EAAE,CAAC;gBACN,QAAQ;gBACR,SAAS,EAAE,QAAQ,GAAG,GAAG;gBACzB,SAAS,EAAE,QAAQ,GAAG,GAAG;gBACzB,QAAQ,EAAE,IAAI,CAAC,SAAS;aACzB,CAAC,CAAA;YAEF,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAA;QACtC,CAAC;IACH,CAAC;IAES,MAAM,CAAC,EAAU;QACzB,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,CAAA;QAEhB,MAAM;IACR,CAAC;IAEQ,MAAM;QACb,aAAa,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,CAAA;QACvC,KAAK,CAAC,MAAM,EAAE,CAAA;IAChB,CAAC;CACF","sourcesContent":["import { BLEND_MODES, Sprite as PixiSprite, Texture as PixiTexture } from 'pixi.js'\nimport { textureLoader } from '../../asset/loaders/texture'\nimport { GameObject, GameObjectOptions } from '../core/game-object'\n\ntype RandomRange = { min: number, max: number }\n\nexport type ParticleSystemOptions = {\n  texture: string\n\n  count: RandomRange\n  lifespan: RandomRange\n  angle: RandomRange\n  velocity: RandomRange\n  scale: RandomRange\n\n  startAlpha?: number\n  fadeRate: number\n  orientToVelocity: boolean\n\n  blendMode?: BLEND_MODES // ex) 'screen', 'multiply'\n} & GameObjectOptions\n\ninterface Particle {\n  sprite: PixiSprite\n\n  age: number\n  lifespan: number\n\n  velocityX: number\n  velocityY: number\n\n  fadeRate: number\n}\n\nfunction random(min: number, max: number) {\n  return Math.random() * (max - min) + min\n}\n\nexport class ParticleSystem extends GameObject {\n  #textureSrc: string\n  #count: RandomRange\n  #lifespan: RandomRange\n  #angle: RandomRange\n  #velocity: RandomRange\n  #scale: RandomRange\n  #startAlpha?: number\n  #fadeRate: number\n  #orientToVelocity: boolean\n  #blendMode?: BLEND_MODES\n\n  #texture?: PixiTexture\n  #loadTexturePromise: Promise<void>\n  #particles: Particle[] = []\n\n  constructor(options: ParticleSystemOptions) {\n    super(options)\n\n    this.#textureSrc = options.texture\n    this.#count = options.count\n    this.#lifespan = options.lifespan\n    this.#angle = options.angle\n    this.#velocity = options.velocity\n    this.#scale = options.scale\n    this.#startAlpha = options.startAlpha\n    this.#fadeRate = options.fadeRate\n    this.#orientToVelocity = options.orientToVelocity\n    this.#blendMode = options.blendMode\n\n    this.#loadTexturePromise = this.#loadTexture()\n  }\n\n  async #loadTexture() {\n    if (textureLoader.checkCached(this.#textureSrc)) {\n      this.#texture = textureLoader.getCached(this.#textureSrc)\n    } else {\n      console.info(`Texture not preloaded. Loading now: ${this.#textureSrc}`)\n      this.#texture = await textureLoader.load(this.#textureSrc)\n    }\n  }\n\n  async burst({ x, y }: { x: number; y: number }) {\n    if (!this.#texture) await this.#loadTexturePromise\n\n    const count = random(this.#count.min, this.#count.max)\n    for (let i = 0; i < count; i++) {\n      const lifespan = random(this.#lifespan.min, this.#lifespan.max)\n      const angle = random(this.#angle.min, this.#angle.max)\n      const sin = Math.sin(angle)\n      const cos = Math.cos(angle)\n      const velocity = random(this.#velocity.min, this.#velocity.max)\n      const scale = random(this.#scale.min, this.#scale.max)\n\n      const sprite = new PixiSprite({\n        x, y,\n        texture: this.#texture,\n        anchor: { x: 0.5, y: 0.5 },\n        scale: { x: scale, y: scale },\n        alpha: this.#startAlpha,\n        blendMode: this.#blendMode,\n        rotation: this.#orientToVelocity ? angle : undefined,\n      })\n\n      this.#particles.push({\n        sprite,\n        age: 0,\n        lifespan,\n        velocityX: velocity * cos,\n        velocityY: velocity * sin,\n        fadeRate: this.#fadeRate,\n      })\n\n      this._pixiContainer.addChild(sprite)\n    }\n  }\n\n  protected update(dt: number) {\n    super.update(dt)\n\n    //TODO\n  }\n\n  override remove() {\n    textureLoader.release(this.#textureSrc)\n    super.remove()\n  }\n}\n"]}