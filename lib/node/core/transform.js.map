{"version":3,"file":"transform.js","sourceRoot":"","sources":["../../../src/node/core/transform.ts"],"names":[],"mappings":"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","sourcesContent":["import { DirtyNumber } from './dirty-number'\n\nexport class LocalTransform {\n  x = 0\n  y = 0\n  scaleX = 1\n  scaleY = 1\n  pivotX = 0\n  pivotY = 0\n\n  #rotation = 0\n  #cos = 1\n  #sin = 0\n\n  get cos() { return this.#cos }\n  get sin() { return this.#sin }\n  get rotation() { return this.#rotation }\n\n  set rotation(v) {\n    if (this.#rotation !== v) {\n      this.#rotation = v\n      this.#cos = Math.cos(v)\n      this.#sin = Math.sin(v)\n    }\n  }\n}\n\nexport class WorldTransform {\n  x = new DirtyNumber(NaN)\n  y = new DirtyNumber(NaN)\n  scaleX = new DirtyNumber(1)\n  scaleY = new DirtyNumber(1)\n  rotation = new DirtyNumber(0)\n  cos = 1\n  sin = 0\n\n  update(parent: WorldTransform, local: LocalTransform) {\n    const rx = local.x * parent.scaleX.v\n    const ry = local.y * parent.scaleY.v\n    const pCos = parent.cos\n    const pSin = parent.sin\n\n    this.scaleX.v = parent.scaleX.v * local.scaleX\n    this.scaleY.v = parent.scaleY.v * local.scaleY\n\n    const pivotX = local.pivotX * this.scaleX.v\n    const pivotY = local.pivotY * this.scaleY.v\n\n    // 로컬 회전\n    const lCos = local.cos\n    const lSin = local.sin\n    // 월드 회전(부모+자식) cos/sin — 덧셈정리\n    const wCos = pCos * lCos - pSin * lSin\n    const wSin = pSin * lCos + pCos * lSin\n\n    // 위치: 부모 회전으로 (rx,ry) 회전 + 월드 회전으로 피벗 보정\n    this.x.v = parent.x.v + (rx * pCos - ry * pSin) - (pivotX * wCos - pivotY * wSin)\n    this.y.v = parent.y.v + (rx * pSin + ry * pCos) - (pivotX * wSin + pivotY * wCos)\n\n    // 회전(스칼라 값)\n    const rot = parent.rotation.v + local.rotation\n    this.rotation.v = rot\n    this.cos = wCos\n    this.sin = wSin\n  }\n\n  get dirty() {\n    return this.x.dirty ||\n      this.y.dirty ||\n      this.scaleX.dirty ||\n      this.scaleY.dirty ||\n      this.rotation.dirty\n  }\n\n  resetDirty() {\n    this.x.resetDirty()\n    this.y.resetDirty()\n    this.scaleX.resetDirty()\n    this.scaleY.resetDirty()\n    this.rotation.resetDirty()\n  }\n}\n"]}