{"version":3,"file":"game-node.js","sourceRoot":"","sources":["../../../src/node/core/game-node.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,YAAY,EAAY,MAAM,wBAAwB,CAAA;AAG/D,MAAM,OAAgB,QAAwC,SAAQ,YAAe;IACnF,SAAS,CAAW;IACpB,OAAO,CAAW;IACR,QAAQ,GAAe,EAAE,CAAC;IAEpC,IAAc,QAAQ,CAAC,QAA8B;QACnD,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAA;QACzB,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;YAClC,KAAK,CAAC,QAAQ,GAAG,QAAQ,CAAA;QAC3B,CAAC;IACH,CAAC;IAED,IAAc,QAAQ;QACpB,OAAO,IAAI,CAAC,SAAS,CAAA;IACvB,CAAC;IAED,IAAc,MAAM,CAAC,MAA4B;QAC/C,IAAI,CAAC,OAAO,GAAG,MAAM,CAAA;IACvB,CAAC;IAED,IAAc,MAAM;QAClB,OAAO,IAAI,CAAC,OAAO,CAAA;IACrB,CAAC;IAED,GAAG,CAAC,GAAG,QAAoB;QACzB,KAAK,MAAM,KAAK,IAAI,QAAQ,EAAE,CAAC;YAE7B,cAAc;YACd,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC;gBAClB,MAAM,GAAG,GAAG,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,CAAA;gBACjD,IAAI,GAAG,KAAK,CAAC,CAAC;oBAAE,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAA;YACvD,CAAC;YAED,YAAY;YACZ,KAAK,CAAC,MAAM,GAAG,IAAI,CAAA;YACnB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;YAEzB,SAAS;YACT,IAAI,IAAI,CAAC,SAAS;gBAAE,KAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAA;QACrD,CAAC;IACH,CAAC;IAED,MAAM;QACJ,KAAK,CAAC,MAAM,EAAE,CAAA;QAEd,WAAW;QACX,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;YACjB,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,CAAA;YAC/C,IAAI,GAAG,KAAK,CAAC,CAAC;gBAAE,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAA;YACpD,IAAI,CAAC,OAAO,GAAG,SAAS,CAAA;QAC1B,CAAC;QAED,WAAW;QACX,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;YAClC,KAAK,CAAC,MAAM,GAAG,SAAS,CAAA;YACxB,KAAK,CAAC,MAAM,EAAE,CAAA;QAChB,CAAC;QACD,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAA;IAC1B,CAAC;IAES,MAAM,CAAC,EAAU;QACzB,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;YAClC,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,CAAA;QAClB,CAAC;IACH,CAAC;CACF","sourcesContent":["import { EventEmitter, EventMap } from '@webtaku/event-emitter'\nimport { Renderer } from '../../renderer/renderer'\n\nexport abstract class GameNode<E extends EventMap = EventMap> extends EventEmitter<E> {\n  #renderer?: Renderer\n  #parent?: GameNode\n  protected children: GameNode[] = [];\n\n  protected set renderer(renderer: Renderer | undefined) {\n    this.#renderer = renderer\n    for (const child of this.children) {\n      child.renderer = renderer\n    }\n  }\n\n  protected get renderer() {\n    return this.#renderer\n  }\n\n  protected set parent(parent: GameNode | undefined) {\n    this.#parent = parent\n  }\n\n  protected get parent() {\n    return this.#parent\n  }\n\n  add(...children: GameNode[]) {\n    for (const child of children) {\n\n      // 기존 부모로부터 제거\n      if (child.#parent) {\n        const idx = child.#parent.children.indexOf(child)\n        if (idx !== -1) child.#parent.children.splice(idx, 1)\n      }\n\n      // 새로운 부모 설정\n      child.parent = this\n      this.children.push(child)\n\n      // 렌더러 설정\n      if (this.#renderer) child.renderer = this.#renderer\n    }\n  }\n\n  remove() {\n    super.remove()\n\n    // 부모로부터 제거\n    if (this.#parent) {\n      const idx = this.#parent.children.indexOf(this)\n      if (idx !== -1) this.#parent.children.splice(idx, 1)\n      this.#parent = undefined\n    }\n\n    // 자식 노드 제거\n    for (const child of this.children) {\n      child.parent = undefined\n      child.remove()\n    }\n    this.children.length = 0\n  }\n\n  protected update(dt: number) {\n    for (const child of this.children) {\n      child.update(dt)\n    }\n  }\n}\n"]}