{"version":3,"file":"tiling-sprite.js","sourceRoot":"","sources":["../../src/game-object-ext/tiling-sprite.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,YAAY,EAAE,MAAM,SAAS,CAAC;AACvC,OAAO,EAAE,aAAa,EAAE,MAAM,0BAA0B,CAAC;AACzD,OAAO,EAAE,UAAU,EAAqB,MAAM,4BAA4B,CAAC;AAS3E,MAAM,kBAAkD,SAAQ,UAAa;IAC3E,OAAO,CAAgB;IACvB,IAAI,CAAU;IAEd,YAAY,CAAU;IACtB,YAAY,CAAU;IAEtB,YAAY,IAA0B;QACpC,KAAK,EAAE,CAAC;QACR,IAAI,IAAI,EAAE,CAAC;YACT,IAAI,IAAI,CAAC,GAAG;gBAAE,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC;YAClC,IAAI,IAAI,CAAC,YAAY;gBAAE,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC;YAC7D,IAAI,IAAI,CAAC,YAAY;gBAAE,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC;QAC/D,CAAC;IACH,CAAC;IAED,KAAK,CAAC,KAAK;QACT,IAAI,IAAI,CAAC,IAAI,EAAE,CAAC;YACd,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;gBAC1C,OAAO,CAAC,IAAI,CAAC,6CAA6C,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC;YACzE,CAAC;YACD,MAAM,OAAO,GAAG,MAAM,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACpD,IAAI,OAAO,EAAE,CAAC;gBACZ,MAAM,MAAM,GAAG,IAAI,YAAY,CAAC;oBAC9B,OAAO;oBACP,MAAM,EAAE,GAAG;oBACX,MAAM,EAAE,CAAC,MAAM;iBAChB,CAAC,CAAC;gBACH,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;gBAC3B,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;YACxB,CAAC;QACH,CAAC;IACH,CAAC;IAED,IAAI,GAAG;QACL,OAAO,IAAI,CAAC,IAAI,CAAC;IACnB,CAAC;IAED,IAAI,GAAG,CAAC,GAAuB;QAC7B,IAAI,CAAC,OAAO,EAAE,OAAO,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC;QAC1C,IAAI,CAAC,OAAO,GAAG,SAAS,CAAC;QACzB,IAAI,IAAI,CAAC,IAAI;YAAE,aAAa,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAChD,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC;QAChB,IAAI,CAAC,KAAK,EAAE,CAAC;IACf,CAAC;IAED,aAAa,CAAC,EAAU,EAAE,EAAkB;QAC1C,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;YACjB,IAAI,IAAI,CAAC,YAAY,KAAK,SAAS;gBAAE,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,IAAI,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;YAC3F,IAAI,IAAI,CAAC,YAAY,KAAK,SAAS;gBAAE,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,IAAI,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;QAC7F,CAAC;QACD,KAAK,CAAC,aAAa,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;IAC9B,CAAC;IAED,MAAM;QACJ,IAAI,IAAI,CAAC,IAAI;YAAE,aAAa,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAChD,KAAK,CAAC,MAAM,EAAE,CAAC;IACjB,CAAC;CACF;AAED,OAAO,EAAE,kBAAkB,EAAE,CAAC","sourcesContent":["import { EventMap } from '@webtaku/event-emitter';\nimport { TilingSprite } from 'pixi.js';\nimport { textureLoader } from '../asset/loaders/texture';\nimport { GameObject, GameObjectOptions } from '../game-object/game-object';\nimport { WorldTransform } from '../game-object/transform';\n\ntype TilingSpriteOptions = {\n  src?: string;\n  scrollSpeedX?: number;\n  scrollSpeedY?: number;\n} & GameObjectOptions;\n\nclass TilingSpriteObject<E extends EventMap = EventMap> extends GameObject<E> {\n  #sprite?: TilingSprite;\n  #src?: string;\n\n  scrollSpeedX?: number;\n  scrollSpeedY?: number;\n\n  constructor(opts?: TilingSpriteOptions) {\n    super();\n    if (opts) {\n      if (opts.src) this.src = opts.src;\n      if (opts.scrollSpeedX) this.scrollSpeedX = opts.scrollSpeedX;\n      if (opts.scrollSpeedY) this.scrollSpeedY = opts.scrollSpeedY;\n    }\n  }\n\n  async #load() {\n    if (this.#src) {\n      if (!textureLoader.checkLoaded(this.#src)) {\n        console.info(`Tiling sprite not preloaded. Loading now: ${this.#src}`);\n      }\n      const texture = await textureLoader.load(this.#src);\n      if (texture) {\n        const sprite = new TilingSprite({\n          texture,\n          anchor: 0.5,\n          zIndex: -999999,\n        });\n        this._addPixiChild(sprite);\n        this.#sprite = sprite;\n      }\n    }\n  }\n\n  get src() {\n    return this.#src;\n  }\n\n  set src(src: string | undefined) {\n    this.#sprite?.destroy({ children: true });\n    this.#sprite = undefined;\n    if (this.#src) textureLoader.release(this.#src);\n    this.#src = src;\n    this.#load();\n  }\n\n  _engineUpdate(dt: number, pt: WorldTransform) {\n    if (this.#sprite) {\n      if (this.scrollSpeedX !== undefined) this.#sprite.tilePosition.x += this.scrollSpeedX * dt;\n      if (this.scrollSpeedY !== undefined) this.#sprite.tilePosition.y += this.scrollSpeedY * dt;\n    }\n    super._engineUpdate(dt, pt);\n  }\n\n  remove() {\n    if (this.#src) textureLoader.release(this.#src);\n    super.remove();\n  }\n}\n\nexport { TilingSpriteObject };\n"]}