{"version":3,"file":"dom-game-object.js","sourceRoot":"","sources":["../../src/dom/dom-game-object.ts"],"names":[],"mappings":"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","sourcesContent":["import { EventEmitter, EventMap } from '@webtaku/event-emitter';\nimport { LocalTransform } from '../game-object/transform';\nimport { addRootObject, removeRootObject } from './dom-world';\n\nexport class DomGameObject<E extends EventMap = EventMap> extends EventEmitter<E & {\n  update: (dt: number) => void\n}> {\n  #lt = new LocalTransform();\n  protected _container = document.createElement('div');\n  #parent?: DomGameObject;\n  #children: DomGameObject[] = [];\n\n  attachToDom(target: HTMLElement) {\n    target.appendChild(this._container);\n    addRootObject(this);\n  }\n\n  add(...children: DomGameObject[]) {\n    for (const child of children) {\n      if (child.#parent) {\n        const idx = child.#parent.#children.indexOf(child);\n        if (idx !== -1) child.#parent.#children.splice(idx, 1);\n      }\n      child.#parent = this;\n\n      this.#children.push(child);\n      this._container.appendChild(child._container);\n    }\n  }\n\n  remove() {\n    if (this.#parent) {\n      const idx = this.#parent.#children.indexOf(this);\n      if (idx !== -1) this.#parent.#children.splice(idx, 1);\n      this.#parent = undefined;\n    }\n\n    for (const child of this.#children) {\n      child.#parent = undefined;\n      child.remove();\n    }\n    this.#children.length = 0;\n\n    this._container.remove();\n    removeRootObject(this);\n  }\n\n  protected update(dt: number): void { }\n\n  protected _afterRender(dt: number) { }\n  _engineUpdate(dt: number) {\n    this.update(dt);\n\n    if (\n      this.#lt.x.dirty ||\n      this.#lt.y.dirty ||\n      this.#lt.scaleX.dirty ||\n      this.#lt.scaleY.dirty ||\n      this.#lt.rotation.dirty\n    ) {\n      this._container.style.transform = `\n      translate(\n        calc(-50% + ${this.#lt.x.v}px),\n        calc(-50% + ${this.#lt.y.v}px)\n      )\n      scale(${this.#lt.scaleX.v}, ${this.#lt.scaleY.v})\n      rotate(${this.#lt.rotation.v}rad)\n    `;\n    }\n    if (this.#lt.alpha.dirty) this._container.style.opacity = this.#lt.alpha.v.toString();\n    this._afterRender(dt);\n\n    (this as any).emit('update', dt);\n\n    for (const child of this.#children) {\n      child._engineUpdate(dt);\n    }\n  }\n\n  constructor(opts?: DomGameObjectOptions) {\n    super();\n    this._container.style.position = 'absolute';\n    this._container.style.left = '0';\n    this._container.style.top = '0';\n    this._container.style.zIndex = '1';\n    this._container.style.transform = 'translate(-50%, -50%)';\n\n    if (opts) {\n      if (opts.x !== undefined) this.x = opts.x;\n      if (opts.y !== undefined) this.y = opts.y;\n      if (opts.pivotX !== undefined) this.pivotX = opts.pivotX;\n      if (opts.pivotY !== undefined) this.pivotY = opts.pivotY;\n      if (opts.scale !== undefined) this.scale = opts.scale;\n      if (opts.scaleX !== undefined) this.scaleX = opts.scaleX;\n      if (opts.scaleY !== undefined) this.scaleY = opts.scaleY;\n      if (opts.rotation !== undefined) this.rotation = opts.rotation;\n      if (opts.alpha !== undefined) this.alpha = opts.alpha;\n      if (opts.drawOrder !== undefined) this.drawOrder = opts.drawOrder;\n    }\n  }\n\n  get x() { return this.#lt.x.v; }\n  set x(v: number) { this.#lt.x.v = v; }\n  get y() { return this.#lt.y.v; }\n  set y(v: number) { this.#lt.y.v = v; }\n  get pivotX() { return this.#lt.pivotX.v; }\n  set pivotX(v: number) { this.#lt.pivotX.v = v; }\n  get pivotY() { return this.#lt.pivotY.v; }\n  set pivotY(v: number) { this.#lt.pivotY.v = v; }\n  get scale() { return this.#lt.scaleX.v; }\n  set scale(v: number) { this.#lt.scaleX.v = v; this.#lt.scaleY.v = v; }\n  get scaleX() { return this.#lt.scaleX.v; }\n  set scaleX(v: number) { this.#lt.scaleX.v = v; }\n  get scaleY() { return this.#lt.scaleY.v; }\n  set scaleY(v: number) { this.#lt.scaleY.v = v; }\n  get rotation() { return this.#lt.rotation.v; }\n  set rotation(v: number) { this.#lt.rotation.v = v; }\n  get alpha() { return this.#lt.alpha.v; }\n  set alpha(v: number) { this.#lt.alpha.v = v; }\n  get drawOrder() { return Number(this._container.style.zIndex); }\n  set drawOrder(v: number) { this._container.style.zIndex = v.toString(); }\n}\n\nexport type DomGameObjectOptions = {\n  x?: number;\n  y?: number;\n  pivotX?: number;\n  pivotY?: number;\n  scale?: number;\n  scaleX?: number;\n  scaleY?: number;\n  rotation?: number;\n  alpha?: number;\n  drawOrder?: number;\n}"]}