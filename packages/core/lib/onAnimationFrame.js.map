{"version":3,"file":"onAnimationFrame.js","sourceRoot":"","sources":["../src/onAnimationFrame.ts"],"names":[],"mappings":"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","sourcesContent":["export type CreateTickerParameters = {\n  backgroundFps?: number | undefined\n  onTick: \n}\n\nexport type Ticker = {\n\n}\n\nexport function onAnimationFrame(\n  listener: (deltaTime: number) => void\n): void\n\nexport function onAnimationFrame(\n  parameters: OnAnimationFrameParameters,\n  listener: (deltaTime: number) => void\n): void\n\nexport function onAnimationFrame(\n  parametersOrListener: OnAnimationFrameParameters | ((deltaTime: number) => void),\n  maybeListener?: (deltaTime: number) => void,\n) {\n  let parameters: OnAnimationFrameParameters\n  let listener: (deltaTime: number) => void\n\n  if (typeof parametersOrListener === 'function') {\n    parameters = {}\n    listener = parametersOrListener\n  } else {\n    parameters = parametersOrListener ?? {}\n    listener = maybeListener!\n  }\n\n  const baseCap = parameters.backgroundFps !== undefined && parameters.backgroundFps > 0\n    ? parameters.backgroundFps : undefined\n\n  let frameId = 0\n  let lastTime = performance.now()\n  let lagSeconds = 0\n  let fpsCap: number | undefined = document.hidden ? baseCap : undefined\n\n  const loop = (timestamp: number) => {\n    frameId = requestAnimationFrame(loop)\n    const deltaTime = (timestamp - lastTime) / 1000\n    if (deltaTime <= 0) return\n    lastTime = timestamp\n\n    if (fpsCap !== undefined) {\n      const fixedStep = 1 / fpsCap\n      lagSeconds += deltaTime\n\n      if (lagSeconds >= fixedStep) {\n        listener(fixedStep)\n        if (lagSeconds >= fixedStep * 2) {\n          listener(deltaTime)\n          lagSeconds = 0\n        } else {\n          lagSeconds -= fixedStep\n        }\n      }\n    } else {\n      listener(deltaTime)\n    }\n  }\n\n  const onBlur = () => {\n    fpsCap = baseCap\n  }\n\n  const onFocus = () => {\n    fpsCap = undefined\n  }\n\n  const onPageshow = (event: PageTransitionEvent) => {\n    if (event.persisted) {\n      fpsCap = undefined\n    }\n  }\n\n  if (baseCap !== undefined) {\n    if (!document.hasFocus()) {\n      onBlur()\n    }\n    window.addEventListener('blur', onBlur)\n    window.addEventListener('focus', onFocus)\n    window.addEventListener('pageshow', onPageshow)\n  }\n\n  frameId = requestAnimationFrame(loop)\n\n  // off\n  return () => {\n    cancelAnimationFrame(frameId)\n\n    if (baseCap !== undefined) {\n      window.removeEventListener('blur', onBlur)\n      window.removeEventListener('focus', onFocus)\n      window.removeEventListener('pageshow', onPageshow)\n    }\n  }\n}\n"]}