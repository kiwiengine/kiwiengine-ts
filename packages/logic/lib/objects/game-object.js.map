{"version":3,"file":"game-object.js","sourceRoot":"","sources":["../../src/objects/game-object.ts"],"names":[],"mappings":"AAAA,OAAO,EAAmB,UAAU,EAAE,IAAI,EAAE,MAAM,kBAAkB,CAAA;AAMpE,MAAM,OAAO,UAAU;IACrB,QAAQ,CAAmB;IAEjB,GAAG,CAAS;IACZ,KAAK,CAAkB;IAEjC,OAAO,CAAa;IACpB,SAAS,GAAiB,EAAE,CAAA;IAE5B,YAAY,OAA0B;QACpC,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAA;IACzB,CAAC;IAED,OAAO,CAAC,QAAgB,EAAE,IAAqB;QAC7C,IAAI,CAAC,OAAO,EAAE,CAAA;QAEd,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YACnC,KAAK,CAAC,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAA;QACpC,CAAC;IACH,CAAC;IAED,OAAO;QACL,IAAI,CAAC,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,GAAG,KAAK,SAAS;YAAE,OAAM;QACjD,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;QAC3B,IAAI,CAAC,KAAK,GAAG,SAAS,CAAA;QACtB,IAAI,CAAC,GAAG,GAAG,SAAS,CAAA;IACtB,CAAC;IAED,GAAG,CAAC,GAAG,QAAsB;QAC3B,KAAK,MAAM,KAAK,IAAI,QAAQ,EAAE,CAAC;YAC7B,IAAI,KAAK,CAAC,OAAO,EAAE,CAAC;gBAClB,MAAM,GAAG,GAAG,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC,KAAK,CAAC,CAAA;gBAClD,IAAI,GAAG,KAAK,CAAC,CAAC;oBAAE,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAA;YACxD,CAAC;YACD,KAAK,CAAC,OAAO,GAAG,IAAI,CAAA;YACpB,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,CAAA;YAE1B,IAAI,IAAI,CAAC,KAAK;gBAAE,KAAK,CAAC,OAAO,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,CAAA;QACjD,CAAC;IACH,CAAC;IAED,OAAO;QACL,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;YACjB,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,CAAA;YAChD,IAAI,GAAG,KAAK,CAAC,CAAC;gBAAE,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAA;YACrD,IAAI,CAAC,OAAO,GAAG,SAAS,CAAA;QAC1B,CAAC;QAED,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YACnC,KAAK,CAAC,OAAO,GAAG,SAAS,CAAA;YACzB,KAAK,CAAC,OAAO,EAAE,CAAA;QACjB,CAAC;QACD,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAA;QAEzB,IAAI,CAAC,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,GAAG,KAAK,SAAS;YAAE,MAAM,IAAI,KAAK,CAAC,6BAA6B,CAAC,CAAA;QACzF,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;QAC3B,IAAI,CAAC,KAAK,GAAG,SAAS,CAAA;QACtB,IAAI,CAAC,GAAG,GAAG,SAAS,CAAA;IACtB,CAAC;CACF;AAED,MAAM,OAAO,UAAW,SAAQ,UAAU;IACxC,YAAY,IAAqB;QAC/B,KAAK,CAAC,EAAE,IAAI,EAAE,UAAU,CAAC,SAAS,EAAE,CAAC,CAAA;QACrC,IAAI,CAAC,GAAG,GAAG,IAAI,CAAA;QACf,IAAI,CAAC,KAAK,GAAG,IAAI,CAAA;IACnB,CAAC;CACF","sourcesContent":["import { ObjectStateTree, ObjectType, ROOT } from '@kiwiengine/core'\n\nexport type GameObjectOptions = {\n  type: ObjectType\n}\n\nexport class GameObject {\n  #options: GameObjectOptions\n\n  protected _id?: number\n  protected _tree?: ObjectStateTree\n\n  #parent?: GameObject\n  #children: GameObject[] = []\n\n  constructor(options: GameObjectOptions) {\n    this.#options = options\n  }\n\n  #attach(parentId: number, tree: ObjectStateTree) {\n    this.#detach()\n\n    for (const child of this.#children) {\n      child.id = tree.addChild(parentId)\n    }\n  }\n\n  #detach() {\n    if (!this._tree || this._id === undefined) return\n    this._tree.remove(this._id)\n    this._tree = undefined\n    this._id = undefined\n  }\n\n  add(...children: GameObject[]) {\n    for (const child of children) {\n      if (child.#parent) {\n        const idx = child.#parent.#children.indexOf(child)\n        if (idx !== -1) child.#parent.#children.splice(idx, 1)\n      }\n      child.#parent = this\n      this.#children.push(child)\n\n      if (this._tree) child.#attach(this, this._tree)\n    }\n  }\n\n  destroy() {\n    if (this.#parent) {\n      const idx = this.#parent.#children.indexOf(this)\n      if (idx !== -1) this.#parent.#children.splice(idx, 1)\n      this.#parent = undefined\n    }\n\n    for (const child of this.#children) {\n      child.#parent = undefined\n      child.destroy()\n    }\n    this.#children.length = 0\n\n    if (!this._tree || this._id === undefined) throw new Error('GameObject is not in a tree')\n    this._tree.remove(this._id)\n    this._tree = undefined\n    this._id = undefined\n  }\n}\n\nexport class RootObject extends GameObject {\n  constructor(tree: ObjectStateTree) {\n    super({ type: ObjectType.CONTAINER })\n    this._id = ROOT\n    this._tree = tree\n  }\n}\n"]}